#
# Context investigation
#
# - master as prod
# - features branches env
#

include:
  - project: SocialGouv/gitlab-ci-yml
    file: /autodevops.yml
    ref: v17.16.0

variables:
  AUTO_DEVOPS_RELEASE_AUTO: "ðŸ”–"
  #AUTO_DEVOPS_PRODUCTION_AUTO: "ðŸš€"
  NOTIFY_DISABLED: 1

Lint:
  rules:
    - when: never

Build:
  extends: .autodevops_build
  variables:
    # these variables are needed at build time because embedded in the front
    NEXT_PUBLIC_SENTRY_DSN: https://e70207cd7a2c4ecdb99849c212a964bf@sentry.fabrique.social.gouv.fr/40
    NEXT_PUBLIC_SENTRY_TOKEN: 1234
    NEXT_PUBLIC_MATOMO_URL: https://matomo.fabrique.social.gouv.fr
    NEXT_PUBLIC_MATOMO_SITE_ID: 25

Register image:
  extends: .autodevops_register_image
  variables:
    DOCKER_BUILD_ARGS: >-
      --shm-size 512M
    IMAGE_NAME: $CI_REGISTRY_IMAGE/app
